/*! For license information please see must-go-faster.js.LICENSE.txt */
(()=>{"use strict";const e=["white","black"],t=["a","b","c","d","e","f","g","h"],o=["1","2","3","4","5","6","7","8"],n=[...o].reverse(),r=Array.prototype.concat(...t.map((e=>o.map((t=>e+t))))),i=e=>r[8*e[0]+e[1]],s=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],a=r.map(s),c=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},l=e=>"white"===e?"black":"white",d=(e,t)=>{const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n},h=(e,t)=>e.role===t.role&&e.color===t.color,u=e=>(t,o)=>[(o?t[0]:7-t[0])*e.width/8,(o?7-t[1]:t[1])*e.height/8],p=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},f=(e,t,o=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${o})`},g=(e,t)=>{e.style.visibility=t?"visible":"hidden"},m=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},v=e=>{var t;return!(2&~(null!==(t=e.buttons)&&void 0!==t?t:0))},b=(e,t)=>{const o=document.createElement(e);return t&&(o.className=t),o};function _(e,t,o){const n=s(e);return t||(n[0]=7-n[0],n[1]=7-n[1]),[o.left+o.width*n[0]/8+o.width/16,o.top+o.height*(7-n[1])/8+o.height/16]}const w=(e,t)=>Math.abs(e-t),y=e=>(t,o,n,r)=>w(t,n)<2&&("white"===e?r===o+1||o<=1&&r===o+2&&t===n:r===o-1||o>=6&&r===o-2&&t===n),k=(e,t,o,n)=>{const r=w(e,o),i=w(t,n);return 1===r&&2===i||2===r&&1===i},C=(e,t,o,n)=>w(e,o)===w(t,n),S=(e,t,o,n)=>e===o||t===n,E=(e,t,o,n)=>C(e,t,o,n)||S(e,t,o,n),P=(e,t,o)=>(n,r,i,s)=>w(n,i)<2&&w(r,s)<2||o&&r===s&&r===("white"===e?0:7)&&(4===n&&(2===i&&t.includes(0)||6===i&&t.includes(7))||t.includes(i));function M(e,t,o){const n=e.get(t);if(!n)return[];const r=s(t),c=n.role,l="pawn"===c?y(n.color):"knight"===c?k:"bishop"===c?C:"rook"===c?S:"queen"===c?E:P(n.color,function(e,t){const o="white"===t?"1":"8",n=[];for(const[r,i]of e)r[1]===o&&i.color===t&&"rook"===i.role&&n.push(s(r)[0]);return n}(e,n.color),o);return a.filter((e=>(r[0]!==e[0]||r[1]!==e[1])&&l(r[0],r[1],e[0],e[1]))).map(i)}function A(e,...t){e&&setTimeout((()=>e(...t)),1)}function T(e){e.premovable.current&&(e.premovable.current=void 0,A(e.premovable.events.unset))}function I(e){const t=e.predroppable;t.current&&(t.current=void 0,A(t.events.unset))}function q(e,t,o){const n=e.pieces.get(t),r=e.pieces.get(o);if(t===o||!n)return!1;const a=r&&r.color!==n.color?r:void 0;return o===e.selected&&O(e),A(e.events.move,t,o,a),function(e,t,o){if(!e.autoCastle)return!1;const n=e.pieces.get(t);if(!n||"king"!==n.role)return!1;const r=s(t),a=s(o);if(0!==r[1]&&7!==r[1]||r[1]!==a[1])return!1;4!==r[0]||e.pieces.has(o)||(6===a[0]?o=i([7,a[1]]):2===a[0]&&(o=i([0,a[1]])));const c=e.pieces.get(o);return!(!c||c.color!==n.color||"rook"!==c.role||(e.pieces.delete(t),e.pieces.delete(o),r[0]<a[0]?(e.pieces.set(i([6,a[1]]),n),e.pieces.set(i([5,a[1]]),c)):(e.pieces.set(i([2,a[1]]),n),e.pieces.set(i([3,a[1]]),c)),0))}(e,t,o)||(e.pieces.set(o,n),e.pieces.delete(t)),e.lastMove=[t,o],e.check=void 0,A(e.events.change),a||!0}function N(e,t,o,n){if(e.pieces.has(o)){if(!n)return!1;e.pieces.delete(o)}return A(e.events.dropNewPiece,t,o),e.pieces.set(o,t),e.lastMove=[o],e.check=void 0,A(e.events.change),e.movable.dests=void 0,e.turnColor=l(e.turnColor),!0}function x(e,t,o){const n=q(e,t,o);return n&&(e.movable.dests=void 0,e.turnColor=l(e.turnColor),e.animation.current=void 0),n}function L(e,t,o){if(F(e,t,o)){const n=x(e,t,o);if(n){const r=e.hold.stop();O(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return!0!==n&&(i.captured=n),A(e.movable.events.after,t,o,i),!0}}else if(function(e,t,o){var n,r;const i=null!==(r=null===(n=e.premovable.customDests)||void 0===n?void 0:n.get(t))&&void 0!==r?r:M(e.pieces,t,e.premovable.castle);return t!==o&&W(e,t)&&i.includes(o)}(e,t,o))return function(e,t,o,n){I(e),e.premovable.current=[t,o],A(e.premovable.events.set,t,o,n)}(e,t,o,{ctrlKey:e.stats.ctrlKey}),O(e),!0;return O(e),!1}function R(e,t,o,n){const r=e.pieces.get(t);r&&(function(e,t,o){const n=e.pieces.get(t);return!(!n||t!==o&&e.pieces.has(o)||"both"!==e.movable.color&&(e.movable.color!==n.color||e.turnColor!==n.color))}(e,t,o)||n)?(e.pieces.delete(t),N(e,r,o,n),A(e.movable.events.afterNewPiece,r.role,o,{premove:!1,predrop:!1})):r&&function(e,t,o){const n=e.pieces.get(t),r=e.pieces.get(o);return!!n&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==o[1]&&"8"!==o[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,o)?function(e,t,o){T(e),e.predroppable.current={role:t,key:o},A(e.predroppable.events.set,t,o)}(e,r.role,o):(T(e),I(e)),e.pieces.delete(t),O(e)}function K(e,t,o){if(A(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return O(e),void e.hold.cancel();if((e.selectable.enabled||o)&&e.selected!==t&&L(e,e.selected,t))return void(e.stats.dragged=!1)}(e.selectable.enabled||e.draggable.enabled)&&($(e,t)||W(e,t))&&(D(e,t),e.hold.start())}function D(e,t){e.selected=t,W(e,t)?e.premovable.customDests||(e.premovable.dests=M(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function O(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function $(e,t){const o=e.pieces.get(t);return!!o&&("both"===e.movable.color||e.movable.color===o.color&&e.turnColor===o.color)}const F=(e,t,o)=>{var n,r;return t!==o&&$(e,t)&&(e.movable.free||!!(null===(r=null===(n=e.movable.dests)||void 0===n?void 0:n.get(t))||void 0===r?void 0:r.includes(o)))};function W(e,t){const o=e.pieces.get(t);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function Q(e){const t=e.premovable.current;if(!t)return!1;const o=t[0],n=t[1];let r=!1;if(F(e,o,n)){const t=x(e,o,n);if(t){const i={premove:!0};!0!==t&&(i.captured=t),A(e.movable.events.after,o,n,i),r=!0}}return T(e),r}function U(e){T(e),I(e),O(e)}function j(e){e.movable.color=e.movable.dests=e.animation.current=void 0,U(e)}function H(e,t,o){let n=Math.floor(8*(e[0]-o.left)/o.width);t||(n=7-n);let r=7-Math.floor(8*(e[1]-o.top)/o.height);return t||(r=7-r),n>=0&&n<8&&r>=0&&r<8?i([n,r]):void 0}const B=e=>"white"===e.orientation,z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",G={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},V={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Z(e){"start"===e&&(e=z);const t=new Map;let o=7,n=0;for(const r of e)switch(r){case" ":case"[":return t;case"/":if(--o,o<0)return t;n=0;break;case"~":{const e=t.get(i([n-1,o]));e&&(e.promoted=!0);break}default:{const e=r.charCodeAt(0);if(e<57)n+=e-48;else{const e=r.toLowerCase();t.set(i([n,o]),{role:G[e],color:r===e?"black":"white"}),++n}}}return t}function X(e,t){t.animation&&(J(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Y(e,t){var o,n,r;if((null===(o=t.movable)||void 0===o?void 0:o.dests)&&(e.movable.dests=void 0),(null===(n=t.drawable)||void 0===n?void 0:n.autoShapes)&&(e.drawable.autoShapes=[]),J(e,t),t.fen&&(e.pieces=Z(t.fen),e.drawable.shapes=(null===(r=t.drawable)||void 0===r?void 0:r.shapes)||[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const[o,n]of e.pieces)"king"===n.role&&n.color===t&&(e.check=o)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&D(e,e.selected),X(e,t),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?"1":"8",o="e"+t,n=e.movable.dests.get(o),r=e.pieces.get(o);if(!n||!r||"king"!==r.role)return;e.movable.dests.set(o,n.filter((e=>!(e==="a"+t&&n.includes("c"+t)||e==="h"+t&&n.includes("g"+t)))))}}function J(e,t){for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&ee(e[o])&&ee(t[o])?J(e[o],t[o]):e[o]=t[o])}function ee(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}const te=(e,t)=>t.animation.enabled?function(e,t){const o=new Map(t.pieces),n=e(t),i=function(e,t){const o=new Map,n=[],i=new Map,s=[],a=[],c=new Map;let l,d,u;for(const[t,o]of e)c.set(t,ne(t,o));for(const e of r)l=t.pieces.get(e),d=c.get(e),l?d?h(l,d.piece)||(s.push(d),a.push(ne(e,l))):a.push(ne(e,l)):d&&s.push(d);for(const e of a)d=re(e,s.filter((t=>h(e.piece,t.piece)))),d&&(u=[d.pos[0]-e.pos[0],d.pos[1]-e.pos[1]],o.set(e.key,u.concat(u)),n.push(d.key));for(const e of s)n.includes(e.key)||i.set(e.key,e.piece);return{anims:o,fadings:i}}(o,t);if(i.anims.size||i.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},e||ie(t,performance.now())}else t.dom.redraw();return n}(e,t):oe(e,t);function oe(e,t){const o=e(t);return t.dom.redraw(),o}const ne=(e,t)=>({key:e,pos:s(e),piece:t}),re=(e,t)=>t.sort(((t,o)=>d(e.pos,t.pos)-d(e.pos,o.pos)))[0];function ie(e,t){const o=e.animation.current;if(void 0===o)return void(e.dom.destroyed||e.dom.redrawNow());const n=1-(t-o.start)*o.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=se(n);for(const e of o.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>ie(e,t)))}}const se=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ae=["green","red","blue","yellow"];function ce(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?O(e):U(e);const o=m(t),n=H(o,B(e),e.dom.bounds());n&&(e.drawable.current={orig:n,pos:o,brush:pe(t),snapToValidMove:e.drawable.defaultSnapToValidMove},le(e))}function le(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const o=H(t.pos,B(e),e.dom.bounds());o||(t.snapToValidMove=!1);const n=t.snapToValidMove?function(e,t,o,n){const r=s(e),c=a.filter((e=>E(r[0],r[1],e[0],e[1])||k(r[0],r[1],e[0],e[1]))),l=c.map((e=>_(i(e),o,n))).map((e=>d(t,e))),[,h]=l.reduce(((e,t,o)=>e[0]<t?e:[t,o]),[l[0],0]);return i(c[h])}(t.orig,t.pos,B(e),e.dom.bounds()):o;n!==t.mouseSq&&(t.mouseSq=n,t.dest=n!==t.orig?n:void 0,e.dom.redrawNow()),le(e)}}))}function de(e,t){e.drawable.current&&(e.drawable.current.pos=m(t))}function he(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const o=e=>e.orig===t.orig&&e.dest===t.dest,n=e.shapes.find(o);n&&(e.shapes=e.shapes.filter((e=>!o(e)))),n&&n.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),fe(e)}(e.drawable,t),ue(e))}function ue(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function pe(e){var t;const o=(e.shiftKey||e.ctrlKey)&&v(e),n=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return ae[(o?1:0)+(n?2:0)]}function fe(e){e.onChange&&e.onChange(e.shapes)}function ge(e){requestAnimationFrame((()=>{var t;const o=e.draggable.current;if(!o)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(o.orig))&&(e.animation.current=void 0);const n=e.pieces.get(o.orig);if(n&&h(n,o.piece)){if(!o.started&&d(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if("function"==typeof o.element){const e=o.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),o.element=e}const t=e.dom.bounds();p(o.element,[o.pos[0]-t.left-t.width/16,o.pos[1]-t.top-t.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==H(o.pos,B(e),t))}}else be(e);ge(e)}))}function me(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=m(t))}function ve(e,t){const o=e.draggable.current;if(!o)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&o.originTarget!==t.target&&!o.newPiece)return void(e.draggable.current=void 0);T(e),I(e);const n=H(m(t)||o.pos,B(e),e.dom.bounds());n&&o.started&&o.orig!==n?o.newPiece?R(e,o.orig,n,o.force):(e.stats.ctrlKey=t.ctrlKey,L(e,o.orig,n)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!n&&(e.pieces.delete(o.orig),A(e.events.change)),(o.orig!==o.previouslySelected&&!o.keyHasChanged||o.orig!==n&&n)&&e.selectable.enabled||O(e),_e(e),e.draggable.current=void 0,e.dom.redraw()}function be(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,O(e),_e(e),e.dom.redraw())}function _e(e){const t=e.dom.elements;t.ghost&&g(t.ghost,!1)}function we(e,t){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===t&&"PIECE"===o.tagName)return o;o=o.nextSibling}}function ye(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}const ke={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ce({orig:e,dest:t,brush:o,piece:n,modifiers:r,customSvg:i,label:s},a,c,l){var d,h,u;return[l.width,l.height,c,e,t,o,a&&"-",n&&Se(n),r&&(u=r,[u.lineWidth,u.hilite&&"*"].filter((e=>e)).join(",")),i&&`custom-${Ee(i.html)},${null!==(h=null===(d=i.center)||void 0===d?void 0:d[0])&&void 0!==h?h:"o"}`,s&&`label-${Ee(s.text)}`].filter((e=>e)).join(",")}function Se(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function Ee(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o)>>>0;return t.toString()}function Pe(e){return["#ffffff","#fff","white"].includes(e.color)?ke.hilitePrimary:ke.hiliteWhite}function Me(e){const t=Ne(qe("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(Ne(qe("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Ae(e,t,o,n,r,i){var s;const a=.4*.75**e.text.length,c=Oe(o,n,r),l="tr"===i?.4:0,d=Ne(qe("g"),{transform:`translate(${c[0]+l},${c[1]-l})`,cgHash:t});d.appendChild(Ne(qe("circle"),{r:.2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:null!==(s=e.fill)&&void 0!==s?s:"#666",stroke:"white"}));const h=Ne(qe("text"),{"font-size":a,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return h.innerHTML=e.text,d.appendChild(h),d}function Te(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function Ie(e,t){return!0===(e&&t.has(e)&&t.get(e).size>1)}function qe(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ne(e,t){for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.setAttribute(o,t[o]);return e}function xe(e,t){return t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}:e}function Le(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Re(e,t){return(e.opacity||1)*(t?.9:1)}function Ke(e,t){const o=Math.min(1,t.width/t.height),n=Math.min(1,t.height/t.width);return[(e[0]-3.5)*o,(3.5-e[1])*n]}function De(e,t,o=!0){const n=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return o?(Math.round(8*n/Math.PI)+16)%16:n}function Oe(e,t,o){let n=function(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce(((e,t)=>e+t*t),0))}(e,t);const r=De(e,t,!1);if(o&&(n-=33/64,o.size>1)){n-=10/64;const r=De(e,t);(o.has((r+1)%16)||o.has((r+15)%16))&&1&r&&(n-=.4)}return[e[0]-Math.cos(r)*n,e[1]-Math.sin(r)*n].map((e=>e+.5))}function $e(e,t){const o=b("coords",t);let n;for(const t of e)n=b("coord"),n.textContent=t,o.appendChild(n);return o}function Fe(e,t,o,n){return e.addEventListener(t,o,n),()=>e.removeEventListener(t,o,n)}const We=e=>t=>{e.draggable.current?be(e):e.drawable.current?ue(e):t.shiftKey||v(t)?e.drawable.enabled&&ce(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;T(e),I(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const n=m(t),r=n&&H(n,B(e),e.dom.bounds());r&&R(e,"a0",r)}e.dom.redraw()}(e,t):function(e,t){if(!e.trustAllEvents&&!t.isTrusted)return;if(void 0!==t.buttons&&t.buttons>1)return;if(t.touches&&t.touches.length>1)return;const o=e.dom.bounds(),n=m(t),r=H(n,B(e),o);if(!r)return;const i=e.pieces.get(r),a=e.selected;var c;if(a||!e.drawable.enabled||!e.drawable.eraseOnClick&&i&&i.color===e.turnColor||(c=e).drawable.shapes.length&&(c.drawable.shapes=[],c.dom.redraw(),fe(c.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||i||a||function(e,t){const o=B(e),n=e.dom.bounds(),r=Math.pow(n.width/8,2);for(const i of e.pieces.keys()){const e=_(i,o,n);if(d(e,t)<=r)return!0}return!1}(e,n)))t.preventDefault();else if(t.touches)return;const l=!!e.premovable.current,h=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&F(e,e.selected,r)?te((e=>K(e,r)),e):K(e,r);const f=e.selected===r,v=we(e,r);if(i&&v&&f&&function(e,t){const o=e.pieces.get(t);return!!o&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}(e,r)){e.draggable.current={orig:r,piece:i,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:v,previouslySelected:a,originTarget:t.target,keyHasChanged:!1},v.cgDragging=!0,v.classList.add("dragging");const c=e.dom.elements.ghost;c&&(c.className=`ghost ${i.color} ${i.role}`,p(c,u(o)(s(r),B(e))),g(c,!0)),ge(e)}else l&&T(e),h&&I(e);e.dom.redraw()}(e,t))},Qe=(e,t,o)=>n=>{e.drawable.current?e.drawable.enabled&&o(e,n):e.viewOnly||t(e,n)};function Ue(e){var t,o;const n=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,i=n.height/n.width,s=8*Math.floor(n.width*window.devicePixelRatio/8)/window.devicePixelRatio,a=s*i;r.style.width=s+"px",r.style.height=a+"px",e.dom.bounds.clear(),null===(t=e.addDimensionsCssVarsTo)||void 0===t||t.style.setProperty("--cg-width",s+"px"),null===(o=e.addDimensionsCssVarsTo)||void 0===o||o.style.setProperty("--cg-height",a+"px")}const je=e=>"PIECE"===e.tagName,He=e=>"SQUARE"===e.tagName;function Be(e,t){for(const o of t)e.dom.elements.board.removeChild(o)}function ze(e,t){const o=e[1];return`${t?10-o:3+o}`}const Ge=e=>`${e.color} ${e.role}`;function Ve(e,t,o){const n=e.get(t);n?e.set(t,`${n} ${o}`):e.set(t,o)}function Ze(e,t,o){const n=e.get(t);n?n.push(o):e.set(t,[o])}const Xe=e=>{var t,o,n;return[e.orig,null===(t=e.piece)||void 0===t?void 0:t.role,null===(o=e.piece)||void 0===o?void 0:o.color,null===(n=e.piece)||void 0===n?void 0:n.scale].join(",")};function Ye(r,i){const a={pieces:Z(z),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:c()};function d(){const n="dom"in a?a.dom.unbind:void 0,i=function(n,r){n.innerHTML="",n.classList.add("cg-wrap");for(const t of e)n.classList.toggle("orientation-"+t,r.orientation===t);n.classList.toggle("manipulable",!r.viewOnly);const i=b("cg-container");n.appendChild(i);const s=b("cg-board");let a,c,l,d;if(i.appendChild(s),r.drawable.visible&&(a=Ne(qe("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(function(){const e=qe("defs"),t=Ne(qe("filter"),{id:"cg-filter-blur"});return t.appendChild(Ne(qe("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}()),a.appendChild(qe("g")),c=Ne(qe("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),c.appendChild(qe("g")),l=b("cg-auto-pieces"),i.appendChild(a),i.appendChild(c),i.appendChild(l)),r.coordinates){const e="black"===r.orientation?" black":"",n="left"===r.ranksPosition?" left":"";i.appendChild($e(o,"ranks"+e+n)),i.appendChild($e(t,"files"+e))}return r.draggable.enabled&&r.draggable.showGhost&&(d=b("piece","ghost"),g(d,!1),i.appendChild(d)),{board:s,container:i,wrap:n,ghost:d,svg:a,customSvg:c,autoPieces:l}}(r,a),c=function(e){let t;const o=()=>(void 0===t&&(t=i.board.getBoundingClientRect()),t);return o.clear=()=>{t=void 0},o}(),l=e=>{(function(e){const t=B(e),o=u(e.dom.bounds()),n=e.dom.elements.board,r=e.pieces,i=e.animation.current,a=i?i.plan.anims:new Map,c=i?i.plan.fadings:new Map,l=e.draggable.current,d=function(e){var t,o,n;const r=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)Ve(r,t,"last-move");if(e.check&&e.highlight.check&&Ve(r,e.check,"check"),e.selected&&(Ve(r,e.selected,"selected"),e.movable.showDests)){const i=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(i)for(const t of i)Ve(r,t,"move-dest"+(e.pieces.has(t)?" oc":""));const s=null!==(n=null===(o=e.premovable.customDests)||void 0===o?void 0:o.get(e.selected))&&void 0!==n?n:e.premovable.dests;if(s)for(const t of s)Ve(r,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}const i=e.premovable.current;if(i)for(const e of i)Ve(r,e,"current-premove");else e.predroppable.current&&Ve(r,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const e of s.keys)Ve(r,e,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach(((e,t)=>{Ve(r,t,e)})),r}(e),h=new Set,f=new Set,g=new Map,m=new Map;let v,_,w,y,k,C,S,E,P,M;for(_=n.firstChild;_;){if(v=_.cgKey,je(_))if(w=r.get(v),k=a.get(v),C=c.get(v),y=_.cgPiece,!_.cgDragging||l&&l.orig===v||(_.classList.remove("dragging"),p(_,o(s(v),t)),_.cgDragging=!1),!C&&_.cgFading&&(_.cgFading=!1,_.classList.remove("fading")),w){if(k&&_.cgAnimating&&y===Ge(w)){const e=s(v);e[0]+=k[2],e[1]+=k[3],_.classList.add("anim"),p(_,o(e,t))}else _.cgAnimating&&(_.cgAnimating=!1,_.classList.remove("anim"),p(_,o(s(v),t)),e.addPieceZIndex&&(_.style.zIndex=ze(s(v),t)));y!==Ge(w)||C&&_.cgFading?C&&y===Ge(C)?(_.classList.add("fading"),_.cgFading=!0):Ze(g,y,_):h.add(v)}else Ze(g,y,_);else if(He(_)){const e=_.className;d.get(v)===e?f.add(v):Ze(m,e,_)}_=_.nextSibling}for(const[e,r]of d)if(!f.has(e)){P=m.get(r),M=P&&P.pop();const i=o(s(e),t);if(M)M.cgKey=e,p(M,i);else{const t=b("square",r);t.cgKey=e,p(t,i),n.insertBefore(t,n.firstChild)}}for(const[i,c]of r)if(k=a.get(i),!h.has(i))if(S=g.get(Ge(c)),E=S&&S.pop(),E){E.cgKey=i,E.cgFading&&(E.classList.remove("fading"),E.cgFading=!1);const n=s(i);e.addPieceZIndex&&(E.style.zIndex=ze(n,t)),k&&(E.cgAnimating=!0,E.classList.add("anim"),n[0]+=k[2],n[1]+=k[3]),p(E,o(n,t))}else{const r=Ge(c),a=b("piece",r),l=s(i);a.cgPiece=r,a.cgKey=i,k&&(a.cgAnimating=!0,l[0]+=k[2],l[1]+=k[3]),p(a,o(l,t)),e.addPieceZIndex&&(a.style.zIndex=ze(l,t)),n.appendChild(a)}for(const t of g.values())Be(e,t);for(const t of m.values())Be(e,t)})(h),i.autoPieces&&function(e,t){!function(t,o,n){const r=new Map,i=[];for(const e of t)r.set(e.hash,!1);let a,c=o.firstElementChild;for(;c;)a=c.getAttribute("cgHash"),r.has(a)?r.set(a,!0):i.push(c),c=c.nextElementSibling;for(const e of i)o.removeChild(e);for(const n of t)r.get(n.hash)||o.appendChild(function(e,{shape:t,hash:o},n){var r,i,a;const c=t.orig,l=null===(r=t.piece)||void 0===r?void 0:r.role,d=null===(i=t.piece)||void 0===i?void 0:i.color,h=null===(a=t.piece)||void 0===a?void 0:a.scale,p=b("piece",`${l} ${d}`);return p.setAttribute("cgHash",o),p.cgKey=c,p.cgScale=h,f(p,u(n)(s(c),B(e)),h),p}(e,n,e.dom.bounds()))}(e.drawable.autoShapes.filter((e=>e.piece)).map((e=>({shape:e,hash:Xe(e),current:!1}))),t)}(h,i.autoPieces),!e&&i.svg&&function(e,t,o){var n;const r=e.drawable,i=r.current,a=i&&i.mouseSq?i:void 0,c=new Map,l=e.dom.bounds(),d=r.autoShapes.filter((e=>!e.piece));for(const t of r.shapes.concat(d).concat(a?[a]:[])){if(!t.dest)continue;const o=null!==(n=c.get(t.dest))&&void 0!==n?n:new Set,r=Ke(Te(s(t.orig),e.orientation),l),i=Ke(Te(s(t.dest),e.orientation),l);o.add(De(r,i)),c.set(t.dest,o)}const h=r.shapes.concat(d).map((e=>({shape:e,current:!1,hash:Ce(e,Ie(e.dest,c),!1,l)})));a&&h.push({shape:a,current:!0,hash:Ce(a,Ie(a.dest,c),!0,l)});const u=h.map((e=>e.hash)).join(";");if(u===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=u;const p=t.querySelector("defs");!function(e,t,o){var n;const r=new Map;let i;for(const o of t.filter((e=>e.shape.dest&&e.shape.brush)))i=xe(e.brushes[o.shape.brush],o.shape.modifiers),(null===(n=o.shape.modifiers)||void 0===n?void 0:n.hilite)&&r.set(Pe(i).key,Pe(i)),r.set(i.key,i);const s=new Set;let a=o.firstElementChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[e,t]of r.entries())s.has(e)||o.appendChild(Me(t))}(r,h,p),function(t,o,n,i){const a=new Map;for(const e of t)a.set(e.hash,!1);for(const e of[o,n]){const t=[];let o,n=e.firstElementChild;for(;n;)o=n.getAttribute("cgHash"),a.has(o)?a.set(o,!0):t.push(n),n=n.nextElementSibling;for(const o of t)e.removeChild(o)}for(const i of t.filter((e=>!a.get(e.hash))))for(const t of function(e,{shape:t,current:o,hash:n},r,i,a){var c,l;const d=Ke(Te(s(t.orig),e.orientation),a),h=t.dest?Ke(Te(s(t.dest),e.orientation),a):d,u=t.brush&&xe(r[t.brush],t.modifiers),p=i.get(t.dest),f=[];if(u){const e=Ne(qe("g"),{cgHash:n});f.push({el:e}),d[0]!==h[0]||d[1]!==h[1]?e.appendChild(function(e,t,o,n,r,i){var s;function a(s){var a;const c=function(e){return(e?20:10)/64}(i&&!r),l=n[0]-o[0],d=n[1]-o[1],h=Math.atan2(d,l),u=Math.cos(h)*c,p=Math.sin(h)*c;return Ne(qe("line"),{stroke:s?Pe(t).color:t.color,"stroke-width":Le(t,r)+(s?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${s?Pe(t).key:t.key})`,opacity:(null===(a=e.modifiers)||void 0===a?void 0:a.hilite)?1:Re(t,r),x1:o[0],y1:o[1],x2:n[0]-u,y2:n[1]-p})}if(!(null===(s=e.modifiers)||void 0===s?void 0:s.hilite))return a(!1);const c=qe("g"),l=Ne(qe("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(function(e,t){const o={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return Ne(qe("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}(o,n)),l.appendChild(a(!0)),c.appendChild(l),c.appendChild(a(!1)),c}(t,u,d,h,o,Ie(t.dest,i))):e.appendChild(function(e,t,o,n){const r=[3/64,4/64],i=(n.width+n.height)/(4*Math.max(n.width,n.height));return Ne(qe("circle"),{stroke:e.color,"stroke-width":r[o?0:1],fill:"none",opacity:Re(e,o),cx:t[0],cy:t[1],r:i-r[1]/2})}(r[t.brush],d,o,a))}if(t.label){const e=t.label;null!==(c=e.fill)&&void 0!==c||(e.fill=t.brush&&r[t.brush].color);const o=t.brush?void 0:"tr";f.push({el:Ae(e,n,d,h,p,o),isCustom:!0})}if(t.customSvg){const e=null!==(l=t.customSvg.center)&&void 0!==l?l:"orig",[o,r]="label"===e?Oe(d,h,p).map((e=>e-.5)):"dest"===e?h:d,i=Ne(qe("g"),{transform:`translate(${o},${r})`,cgHash:n});i.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,f.push({el:i,isCustom:!0})}return f}(e,i,r.brushes,c,l))t.isCustom?n.appendChild(t.el):o.appendChild(t.el)}(h,t.querySelector("g"),o.querySelector("g"))}(h,i.svg,i.customSvg)},d=()=>{Ue(h),function(e){const t=B(e),o=u(e.dom.bounds());let n=e.dom.elements.board.firstChild;for(;n;)(je(n)&&!n.cgAnimating||He(n))&&p(n,o(s(n.cgKey),t)),n=n.nextSibling}(h),i.autoPieces&&function(e){var t;const o=B(e),n=u(e.dom.bounds());let r=null===(t=e.dom.elements.autoPieces)||void 0===t?void 0:t.firstChild;for(;r;)f(r,n(s(r.cgKey),o),r.cgScale),r=r.nextSibling}(h)},h=a;return h.dom={elements:i,bounds:c,redraw:Je(l),redrawNow:l,unbind:n},h.drawable.prevSvgHash="",Ue(h),l(!1),function(e,t){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",(e=>e.preventDefault())),e.viewOnly)return;const n=We(e);o.addEventListener("touchstart",n,{passive:!1}),o.addEventListener("mousedown",n,{passive:!1})}(h,d),n||(h.dom.unbind=function(e,t){const o=[];if("ResizeObserver"in window||o.push(Fe(document.body,"chessground.resize",t)),!e.viewOnly){const t=Qe(e,me,de),n=Qe(e,ve,he);for(const e of["touchmove","mousemove"])o.push(Fe(document,e,t));for(const e of["touchend","mouseup"])o.push(Fe(document,e,n));const r=()=>e.dom.bounds.clear();o.push(Fe(document,"scroll",r,{capture:!0,passive:!0})),o.push(Fe(window,"resize",r,{passive:!0}))}return()=>o.forEach((e=>e()))}(h,d)),h.events.insert&&h.events.insert(i),h}return Y(a,i||{}),function(e,o){function r(){!function(e){e.orientation=l(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}(e),o()}return{set(t){t.orientation&&t.orientation!==e.orientation&&r(),X(e,t),(t.fen?te:oe)((e=>Y(e,t)),e)},state:e,getFen:()=>{return o=e.pieces,n.map((e=>t.map((t=>{const n=o.get(t+e);if(n){let e=V[n.role];return"white"===n.color&&(e=e.toUpperCase()),n.promoted&&(e+="~"),e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()));var o},toggleOrientation:r,setPieces(t){te((e=>function(e,t){for(const[o,n]of t)n?e.pieces.set(o,n):e.pieces.delete(o)}(e,t)),e)},selectSquare(t,o){t?te((e=>K(e,t,o)),e):e.selected&&(O(e),e.dom.redraw())},move(t,o){te((e=>q(e,t,o)),e)},newPiece(t,o){te((e=>N(e,t,o)),e)},playPremove(){if(e.premovable.current){if(te(Q,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=function(e,t){const o=e.predroppable.current;let n=!1;return!!o&&(t(o)&&N(e,{role:o.role,color:e.movable.color},o.key)&&(A(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),n=!0),I(e),n)}(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){oe(T,e)},cancelPredrop(){oe(I,e)},cancelMove(){oe((e=>{U(e),be(e)}),e)},stop(){oe((e=>{j(e),be(e)}),e)},explode(t){!function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{ye(e,2),setTimeout((()=>ye(e,void 0)),120)}),120)}(e,t)},setAutoShapes(t){oe((e=>e.drawable.autoShapes=t),e)},setShapes(t){oe((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>H(t,B(e),e.dom.bounds()),redrawAll:o,dragNewPiece(t,o,n){!function(e,t,o,n){const r="a0";e.pieces.set(r,t),e.dom.redraw();const i=m(o);e.draggable.current={orig:r,piece:t,origPos:i,pos:i,started:!0,element:()=>we(e,r),originTarget:o.target,newPiece:!0,force:!!n,keyHasChanged:!1},ge(e)}(e,t,o,n)},destroy(){j(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}(d(),d)}function Je(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}const et="w",tt="b",ot="p",nt="b",rt="r",it="q",st="k",at="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",ct=-1,lt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},dt=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],ht={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ut={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},pt={b:[16,32,17,15],w:[-16,-32,-17,-15]},ft={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},gt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],mt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],vt={p:1,n:2,b:4,r:8,q:16,k:32},bt=["n",nt,rt,it],_t={[st]:ht.KSIDE_CASTLE,[it]:ht.QSIDE_CASTLE},wt={w:[{square:ut.a1,flag:ht.QSIDE_CASTLE},{square:ut.h1,flag:ht.KSIDE_CASTLE}],b:[{square:ut.a8,flag:ht.QSIDE_CASTLE},{square:ut.h8,flag:ht.KSIDE_CASTLE}]},yt={b:1,w:6},kt=["1-0","0-1","1/2-1/2","*"];function Ct(e){return e>>4}function St(e){return 15&e}function Et(e){return-1!=="0123456789".indexOf(e)}function Pt(e){const t=St(e),o=Ct(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(o,o+1)}function Mt(e){return e===et?tt:et}function At(e,t,o,n,r,i=void 0,s=ht.NORMAL){const a=Ct(n);if(r!==ot||7!==a&&0!==a)e.push({color:t,from:o,to:n,piece:r,captured:i,flags:s});else for(let a=0;a<bt.length;a++){const c=bt[a];e.push({color:t,from:o,to:n,piece:r,captured:i,promotion:c,flags:s|ht.PROMOTION})}}function Tt(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return ot}return t=t.toLowerCase(),"o"===t?st:t}function It(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function qt(e){return e.split(" ").slice(0,4).join(" ")}const Nt=new class{_board=new Array(128);_turn=et;_header={};_kings={w:ct,b:ct};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(e=at){this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:ct,b:ct},this._turn=et,this._castling={w:0,b:0},this._epSquare=ct,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:o=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const t=["-","-","0","1"];e=n.concat(t.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!t){const{ok:t,error:o}=function(e){const t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const o=parseInt(t[5],10);if(isNaN(o)||o<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const n=parseInt(t[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=t[0].split("/");if(8!==r.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<r.length;e++){let t=0,o=!1;for(let n=0;n<r[e].length;n++)if(Et(r[e][n])){if(o)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(r[e][n],10),o=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[e][n]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,o=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:e,regex:o}of i){if(!o.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(r[0]+r[7]).some((e=>"P"===e.toUpperCase()))?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw new Error(o)}const r=n[0];let i=0;this.clear({preserveHeaders:o});for(let e=0;e<r.length;e++){const t=r.charAt(e);if("/"===t)i+=8;else if(Et(t))i+=parseInt(t,10);else{const e=t<"a"?et:tt;this._put({type:t.toLowerCase(),color:e},Pt(i)),i++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=ht.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=ht.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=ht.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=ht.QSIDE_CASTLE),this._epSquare="-"===n[3]?ct:ut[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){let e=0,t="";for(let o=ut.a8;o<=ut.h1;o++){if(this._board[o]){e>0&&(t+=e,e=0);const{color:n,type:r}=this._board[o];t+=n===et?r.toUpperCase():r.toLowerCase()}else e++;o+1&136&&(e>0&&(t+=e),o!==ut.h1&&(t+="/"),e=0,o+=8)}let o="";this._castling[et]&ht.KSIDE_CASTLE&&(o+="K"),this._castling[et]&ht.QSIDE_CASTLE&&(o+="Q"),this._castling[tt]&ht.KSIDE_CASTLE&&(o+="k"),this._castling[tt]&ht.QSIDE_CASTLE&&(o+="q"),o=o||"-";let n="-";if(this._epSquare!==ct){const e=this._epSquare+(this._turn===et?16:-16),t=[e+1,e-1];for(const e of t){if(136&e)continue;const t=this._turn;if(this._board[e]?.color===t&&this._board[e]?.type===ot){this._makeMove({color:t,from:e,to:this._epSquare,piece:ot,captured:ot,flags:ht.EP_CAPTURE});const o=!this._isKingAttacked(t);if(this._undoMove(),o){n=Pt(this._epSquare);break}}}}return[t,this._turn,o,n,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==at?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(at)}get(e){return this._board[ut[e]]||!1}put({type:e,color:t},o){return!!this._put({type:e,color:t},o)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_put({type:e,color:t},o){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase()))return!1;if(!(o in ut))return!1;const n=ut[o];if(e==st&&this._kings[t]!=ct&&this._kings[t]!=n)return!1;const r=this._board[n];return r&&r.type===st&&(this._kings[r.color]=ct),this._board[n]={type:e,color:t},e===st&&(this._kings[t]=n),!0}remove(e){const t=this.get(e);return delete this._board[ut[e]],t&&t.type===st&&(this._kings[t.color]=ct),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){const e=this._board[ut.e1]?.type===st&&this._board[ut.e1]?.color===et,t=this._board[ut.e8]?.type===st&&this._board[ut.e8]?.color===tt;e&&this._board[ut.a1]?.type===rt&&this._board[ut.a1]?.color===et||(this._castling.w&=~ht.QSIDE_CASTLE),e&&this._board[ut.h1]?.type===rt&&this._board[ut.h1]?.color===et||(this._castling.w&=~ht.KSIDE_CASTLE),t&&this._board[ut.a8]?.type===rt&&this._board[ut.a8]?.color===tt||(this._castling.b&=~ht.QSIDE_CASTLE),t&&this._board[ut.h8]?.type===rt&&this._board[ut.h8]?.color===tt||(this._castling.b&=~ht.KSIDE_CASTLE)}_updateEnPassantSquare(){if(this._epSquare===ct)return;const e=this._epSquare+(this._turn===et?-16:16),t=this._epSquare+(this._turn===et?16:-16),o=[t+1,t-1];null===this._board[e]&&null===this._board[this._epSquare]&&this._board[t]?.color===Mt(this._turn)&&this._board[t]?.type===ot&&o.some((e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type===ot))||(this._epSquare=ct)}_attacked(e,t){for(let o=ut.a8;o<=ut.h1;o++){if(136&o){o+=7;continue}if(void 0===this._board[o]||this._board[o].color!==e)continue;const n=this._board[o],r=o-t;if(0===r)continue;const i=r+119;if(gt[i]&vt[n.type]){if(n.type===ot){if(r>0){if(n.color===et)return!0}else if(n.color===tt)return!0;continue}if("n"===n.type||"k"===n.type)return!0;const e=mt[i];let s=o+e,a=!1;for(;s!==t;){if(null!=this._board[s]){a=!0;break}s+=e}if(!a)return!0}}return!1}_isKingAttacked(e){const t=this._kings[e];return-1!==t&&this._attacked(Mt(e),t)}isAttacked(e,t){return this._attacked(t,ut[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let o=0,n=0;for(let r=ut.a8;r<=ut.h1;r++){if(n=(n+1)%2,136&r){r+=7;continue}const i=this._board[r];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===nt&&t.push(n),o++)}if(2===o)return!0;if(3===o&&(1===e[nt]||1===e.n))return!0;if(o===e[nt]+2){let e=0;const o=t.length;for(let n=0;n<o;n++)e+=t[n];if(0===e||e===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:o}={}){const n=this._moves({square:t,piece:o});return e?n.map((e=>this._makePretty(e))):n.map((e=>this._moveToSan(e,n)))}_moves({legal:e=!0,piece:t,square:o}={}){const n=o?o.toLowerCase():void 0,r=t?.toLowerCase(),i=[],s=this._turn,a=Mt(s);let c=ut.a8,l=ut.h1,d=!1;if(n){if(!(n in ut))return[];c=l=ut[n],d=!0}for(let e=c;e<=l;e++){if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===a)continue;const{type:t}=this._board[e];let o;if(t===ot){if(r&&r!==t)continue;o=e+pt[s][0],this._board[o]||(At(i,s,e,o,ot),o=e+pt[s][1],yt[s]!==Ct(e)||this._board[o]||At(i,s,e,o,ot,void 0,ht.BIG_PAWN));for(let t=2;t<4;t++)o=e+pt[s][t],136&o||(this._board[o]?.color===a?At(i,s,e,o,ot,this._board[o].type,ht.CAPTURE):o===this._epSquare&&At(i,s,e,o,ot,ot,ht.EP_CAPTURE))}else{if(r&&r!==t)continue;for(let n=0,r=ft[t].length;n<r;n++){const r=ft[t][n];for(o=e;o+=r,!(136&o);){if(this._board[o]){if(this._board[o].color===s)break;At(i,s,e,o,t,this._board[o].type,ht.CAPTURE);break}if(At(i,s,e,o,t),"n"===t||t===st)break}}}}if(!(void 0!==r&&r!==st||d&&l!==this._kings[s])){if(this._castling[s]&ht.KSIDE_CASTLE){const e=this._kings[s],t=e+2;this._board[e+1]||this._board[t]||this._attacked(a,this._kings[s])||this._attacked(a,e+1)||this._attacked(a,t)||At(i,s,this._kings[s],t,st,void 0,ht.KSIDE_CASTLE)}if(this._castling[s]&ht.QSIDE_CASTLE){const e=this._kings[s],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(a,this._kings[s])||this._attacked(a,e-1)||this._attacked(a,t)||At(i,s,this._kings[s],t,st,void 0,ht.QSIDE_CASTLE)}}if(!e||-1===this._kings[s])return i;const h=[];for(let e=0,t=i.length;e<t;e++)this._makeMove(i[e]),this._isKingAttacked(s)||h.push(i[e]),this._undoMove();return h}move(e,{strict:t=!1}={}){let o=null;if("string"==typeof e)o=this._moveFromSan(e,t);else if("object"==typeof e){const t=this._moves();for(let n=0,r=t.length;n<r;n++)if(e.from===Pt(t[n].from)&&e.to===Pt(t[n].to)&&(!("promotion"in t[n])||e.promotion===t[n].promotion)){o=t[n];break}}if(!o)throw"string"==typeof e?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const n=this._makePretty(o);return this._makeMove(o),this._incPositionCount(n.after),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,o=Mt(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&ht.EP_CAPTURE&&(this._turn===tt?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===st){if(this._kings[t]=e.to,e.flags&ht.KSIDE_CASTLE){const t=e.to-1,o=e.to+1;this._board[t]=this._board[o],delete this._board[o]}else if(e.flags&ht.QSIDE_CASTLE){const t=e.to+1,o=e.to-2;this._board[t]=this._board[o],delete this._board[o]}this._castling[t]=0}if(this._castling[t])for(let o=0,n=wt[t].length;o<n;o++)if(e.from===wt[t][o].square&&this._castling[t]&wt[t][o].flag){this._castling[t]^=wt[t][o].flag;break}if(this._castling[o])for(let t=0,n=wt[o].length;t<n;t++)if(e.to===wt[o][t].square&&this._castling[o]&wt[o][t].flag){this._castling[o]^=wt[o][t].flag;break}e.flags&ht.BIG_PAWN?this._epSquare=t===tt?e.to-16:e.to+16:this._epSquare=ct,e.piece===ot||e.flags&(ht.CAPTURE|ht.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===tt&&this._moveNumber++,this._turn=o}undo(){const e=this._undoMove();if(e){const t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(void 0===e)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const o=this._turn,n=Mt(o);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&ht.EP_CAPTURE){let e;e=o===tt?t.to-16:t.to+16,this._board[e]={type:ot,color:n}}else this._board[t.to]={type:t.captured,color:n};if(t.flags&(ht.KSIDE_CASTLE|ht.QSIDE_CASTLE)){let e,o;t.flags&ht.KSIDE_CASTLE?(e=t.to+1,o=t.to-1):(e=t.to-2,o=t.to+1),this._board[e]=this._board[o],delete this._board[o]}return t}pgn({newline:e="\n",maxWidth:t=0}={}){const o=[];let n=!1;for(const t in this._header)o.push("["+t+' "'+this._header[t]+'"]'+e),n=!0;n&&this._history.length&&o.push(e);const r=e=>{const t=this._comments[this.fen()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},i=[];for(;this._history.length>0;)i.push(this._undoMove());const s=[];let a="";for(0===i.length&&s.push(r(""));i.length>0;){a=r(a);const e=i.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(a.length&&s.push(a),a=this._moveNumber+".");else{const e=`${this._moveNumber}. ...`;a=a?`${a} ${e}`:e}a=a+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(a.length&&s.push(r(a)),void 0!==this._header.Result&&s.push(this._header.Result),0===t)return o.join("")+s.join(" ");const c=function(){return o.length>0&&" "===o[o.length-1]&&(o.pop(),!0)},l=function(n,r){for(const i of r.split(" "))if(i){if(n+i.length>t){for(;c();)n--;o.push(e),n=0}o.push(i),n+=i.length,o.push(" "),n++}return c()&&n--,n};let d=0;for(let n=0;n<s.length;n++)d+s[n].length>t&&s[n].includes("{")?d=l(d,s[n]):(d+s[n].length>t&&0!==n?(" "===o[o.length-1]&&o.pop(),o.push(e),d=0):0!==n&&(o.push(" "),d++),o.push(s[n]),d+=s[n].length);return o.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:o="\r?\n"}={}){function n(e){return e.replace(/\\/g,"\\")}e=e.trim();const r=new RegExp("^(\\[((?:"+n(o)+")|.)*\\])((?:\\s*"+n(o)+"){2}|(?:\\s*"+n(o)+")*$)").exec(e),i=r&&r.length>=2?r[1]:"";this.reset();const s=function(e){const t={},r=e.split(new RegExp(n(o)));let i="",s="";for(let e=0;e<r.length;e++){const o=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;i=r[e].replace(o,"$1"),s=r[e].replace(o,"$2"),i.trim().length>0&&(t[i]=s)}return t}(i);let a="";for(const e in s)"fen"===e.toLowerCase()&&(a=s[e]),this.header(e,s[e]);if(t){if("1"===s.SetUp){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}}else a&&this.load(a,{preserveHeaders:!0});const c=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(n(o),"g")," ")).slice(1,e.length-1))}}`},l=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+(e.match(/.{1,2}/g)||[]).join("%"))}(e.slice(1,e.length-1))};let d=e.replace(i,"").replace(new RegExp(`({[^}]*})+?|;([^${n(o)}]*)`,"g"),(function(e,t,o){return void 0!==t?c(t):" "+c(`{${o.slice(1)}}`)})).replace(new RegExp(n(o),"g")," ");const h=/(\([^()]+\))+?/g;for(;h.test(d);)d=d.replace(h,"");d=d.replace(/\d+\.(\.\.)?/g,""),d=d.replace(/\.\.\./g,""),d=d.replace(/\$\d+/g,"");let u=d.trim().split(new RegExp(/\s+/));u=u.filter((e=>""!==e));let p="";for(let e=0;e<u.length;e++){const o=l(u[e]);if(void 0!==o){this._comments[this.fen()]=o;continue}const n=this._moveFromSan(u[e],t);if(null==n){if(!(kt.indexOf(u[e])>-1))throw new Error(`Invalid move in PGN: ${u[e]}`);p=u[e]}else p="",this._makeMove(n),this._incPositionCount(this.fen())}p&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",p)}_moveToSan(e,t){let o="";if(e.flags&ht.KSIDE_CASTLE)o="O-O";else if(e.flags&ht.QSIDE_CASTLE)o="O-O-O";else{if(e.piece!==ot){const n=function(e,t){const o=e.from,n=e.to,r=e.piece;let i=0,s=0,a=0;for(let e=0,c=t.length;e<c;e++){const c=t[e].from,l=t[e].to;r===t[e].piece&&o!==c&&n===l&&(i++,Ct(o)===Ct(c)&&s++,St(o)===St(c)&&a++)}return i>0?s>0&&a>0?Pt(o):a>0?Pt(o).charAt(1):Pt(o).charAt(0):""}(e,t);o+=e.piece.toUpperCase()+n}e.flags&(ht.CAPTURE|ht.EP_CAPTURE)&&(e.piece===ot&&(o+=Pt(e.from)[0]),o+="x"),o+=Pt(e.to),e.promotion&&(o+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?o+="#":o+="+"),this._undoMove(),o}_moveFromSan(e,t=!1){const o=It(e);let n,r,i,s,a,c=Tt(o),l=this._moves({legal:!0,piece:c});for(let e=0,t=l.length;e<t;e++)if(o===It(this._moveToSan(l[e],l)))return l[e];if(t)return null;let d=!1;if(r=o.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),r?(n=r[1],i=r[2],s=r[3],a=r[4],1==i.length&&(d=!0)):(r=o.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),r&&(n=r[1],i=r[2],s=r[3],a=r[4],1==i.length&&(d=!0))),c=Tt(o),l=this._moves({legal:!0,piece:n||c}),!s)return null;for(let e=0,t=l.length;e<t;e++)if(i){if(!(n&&n.toLowerCase()!=l[e].piece||ut[i]!=l[e].from||ut[s]!=l[e].to||a&&a.toLowerCase()!=l[e].promotion))return l[e];if(d){const t=Pt(l[e].from);if(!(n&&n.toLowerCase()!=l[e].piece||ut[s]!=l[e].to||i!=t[0]&&i!=t[1]||a&&a.toLowerCase()!=l[e].promotion))return l[e]}}else if(o===It(this._moveToSan(l[e],l)).replace("x",""))return l[e];return null}ascii(){let e="   +------------------------+\n";for(let t=ut.a8;t<=ut.h1;t++){if(0===St(t)&&(e+=" "+"87654321"[Ct(t)]+" |"),this._board[t]){const o=this._board[t].type;e+=" "+(this._board[t].color===et?o.toUpperCase():o.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let o=0;const n=this._turn;for(let r=0,i=t.length;r<i;r++)this._makeMove(t[r]),this._isKingAttacked(n)||(e-1>0?o+=this.perft(e-1):o++),this._undoMove();return o}_makePretty(e){const{color:t,piece:o,from:n,to:r,flags:i,captured:s,promotion:a}=e;let c="";for(const e in ht)ht[e]&i&&(c+=lt[e]);const l=Pt(n),d=Pt(r),h={color:t,piece:o,from:l,to:d,san:this._moveToSan(e,this._moves({legal:!0})),flags:c,lan:l+d,before:this.fen(),after:""};return this._makeMove(e),h.after=this.fen(),this._undoMove(),s&&(h.captured=s),a&&(h.promotion=a,h.lan+=a),h}turn(){return this._turn}board(){const e=[];let t=[];for(let o=ut.a8;o<=ut.h1;o++)null==this._board[o]?t.push(null):t.push({square:Pt(o),type:this._board[o].type,color:this._board[o].color}),o+1&136&&(e.push(t),t=[],o+=8);return e}squareColor(e){if(e in ut){const t=ut[e];return(Ct(t)+St(t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],o=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const n=t.pop();if(!n)break;e?o.push(this._makePretty(n)):o.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return o}_getPositionCount(e){const t=qt(e);return this._positionCount[t]||0}_incPositionCount(e){const t=qt(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=qt(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},o=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(o(this.fen());;){const t=e.pop();if(!t)break;this._makeMove(t),o(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>({fen:e,comment:this._comments[e]})))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}}))}setCastlingRights(e,t){for(const o of[st,it])void 0!==t[o]&&(t[o]?this._castling[e]|=_t[o]:this._castling[e]&=~_t[o]);this._updateCastlingRights();const o=this.getCastlingRights(e);return!(void 0!==t[st]&&t[st]!==o[st]||void 0!==t[it]&&t[it]!==o[it])}getCastlingRights(e){return{[st]:!!(this._castling[e]&_t[st]),[it]:!!(this._castling[e]&_t[it])}}moveNumber(){return this._moveNumber}};function xt(e){const t=new Map;return dt.forEach((o=>{const n=e.moves({square:o,verbose:!0});n.length&&t.set(o,n.map((e=>e.to)))})),t}function Lt(e){return console.log(e.turn()),"w"===e.turn()?"white":"black"}function Rt(e){return function(t,o,n){console.log({from:t,to:o,meta:n}),Nt.move({from:t,to:o}),e.set({turnColor:Lt(Nt),movable:{color:Lt(Nt),dests:xt(Nt)}})}}window.onload=function(){const e={movable:{free:!1,color:"white",dests:xt(Nt)}},t=Ye(document.querySelector("#board"),e);t.set({movable:{events:{after:Rt(t)}}}),function(){fetch("ws://10.0.0.73:8000/connect").then().catch();const e=document.querySelector("#connect-button");console.log({button:e}),e.addEventListener("click",(function(){ws=new WebSocket("ws://10.0.0.73:8000/connect",[]),ws.send("testing send...")}))}()}})();